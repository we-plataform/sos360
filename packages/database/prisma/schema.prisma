generator client {
  provider        = "prisma-client-js"
  // Precompile for both local dev and production
  previewFeatures = []
}

datasource db {
  provider  = "postgresql"
  // Use connection pooling URL (pgbouncer) for normal operations
  url       = env("DATABASE_URL")
  // Direct connection for migrations (bypasses pgbouncer)
  directUrl = env("DIRECT_URL")
}

// NOTE: For Neon, ensure:
// DATABASE_URL=postgresql://[user]:[password]@[region].neon.tech/neondb?sslmode=require
// DIRECT_URL=postgresql://[user]:[password]@[region].neon.tech/neondb?sslmode=require

// ============================================
// COMPANY (NEW - Multi-workspace support)
// ============================================

model Company {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique // URL-friendly identifier
  plan        Plan     @default(trial)
  settings    Json     @default("{}")
  billingInfo Json     @default("{}") // Stripe customer info, etc
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workspaces  Workspace[]
  members     CompanyMember[]
  invitations CompanyInvitation[]

  @@map("companies")
}

enum Plan {
  trial
  starter
  professional
  business
  enterprise
}

enum CompanyRole {
  owner  // Dono da empresa (billing, pode deletar empresa)
  admin  // Administrador (pode criar workspaces, gerenciar membros)
  member // Membro padrão (acesso aos workspaces atribuídos)
}

// Associação Usuário <-> Empresa (N:N com role)
model CompanyMember {
  userId    String
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  companyId String
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  role      CompanyRole @default(member)
  createdAt DateTime    @default(now())

  @@id([userId, companyId])
  @@index([companyId])
  @@map("company_members")
}

// Convites para Empresa
model CompanyInvitation {
  id        String           @id @default(cuid())
  email     String
  role      CompanyRole      @default(member)
  token     String           @unique @default(cuid())
  status    InvitationStatus @default(pending)
  expiresAt DateTime
  createdAt DateTime         @default(now())

  companyId String
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  // Workspaces que o convidado terá acesso: [{workspaceId, role}]
  workspaceAccess Json @default("[]")

  @@unique([companyId, email])
  @@index([token])
  @@map("company_invitations")
}

// ============================================
// WORKSPACE & USERS
// ============================================

model Workspace {
  id        String   @id @default(cuid())
  name      String
  settings  Json     @default("{}")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  companyId String
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  members     WorkspaceMember[]
  leads       Lead[]
  socialProfiles SocialProfile[]
  tags        Tag[]
  templates   Template[]
  automations Automation[]
  webhooks    Webhook[]
  importJobs  ImportJob[]
  pipelines   Pipeline[]
  audiences   Audience[]
  posts       Post[]
  scoringConfig ScoringConfig?

  @@index([companyId])
  @@map("workspaces")
}

enum WorkspaceRole {
  owner   // Pode gerenciar workspace, deletar, etc
  admin   // Pode gerenciar usuários do workspace
  manager // Pode ver tudo, gerenciar leads
  agent   // Pode interagir com leads atribuídos
  viewer  // Apenas visualização
}

// Associação Usuário <-> Workspace (N:N com role)
model WorkspaceMember {
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  role        WorkspaceRole @default(agent)
  createdAt   DateTime      @default(now())

  @@id([userId, workspaceId])
  @@index([workspaceId])
  @@map("workspace_members")
}

model User {
  id           String    @id @default(cuid())
  email        String    @unique
  passwordHash String
  fullName     String
  avatarUrl    String?
  settings     Json      @default("{}")
  lastLoginAt  DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // Multi-workspace relations
  companies  CompanyMember[]
  workspaces WorkspaceMember[]

  // Business relations (these reference user directly, workspace context comes from the entity itself)
  assignedLeads         Lead[]         @relation("AssignedLeads")
  assignedConversations Conversation[] @relation("AssignedConversations")
  sentMessages          Message[]      @relation("SentMessages")
  createdTemplates      Template[]     @relation("CreatedTemplates")
  createdAutomations    Automation[]   @relation("CreatedAutomations")
  activities            Activity[]     @relation("UserActivities")

  @@index([email])
  @@map("users")
}

enum InvitationStatus {
  pending
  accepted
  expired
}

model RefreshToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([token])
  @@map("refresh_tokens")
}

// ============================================
// PIPELINES
// ============================================

model Pipeline {
  id          String   @id @default(cuid())
  name        String
  description String?
  isDefault   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  stages PipelineStage[]

  @@unique([workspaceId, name])
  @@index([workspaceId])
  @@map("pipelines")
}

model PipelineStage {
  id        String   @id @default(cuid())
  name      String
  color     String   @default("#6366F1")
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  pipelineId String
  pipeline   Pipeline @relation(fields: [pipelineId], references: [id], onDelete: Cascade)

  leads       Lead[]
  automations Automation[]

  @@unique([pipelineId, name])
  @@index([pipelineId, order])
  @@map("pipeline_stages")
}

// ============================================
// LEADS
// ============================================

model Lead {
  id                String     @id @default(cuid())
  platform          Platform?
  username          String?
  fullName          String?
  profileUrl        String?
  avatarUrl         String?
  bio               String?
  email             String?
  phone             String?
  website           String?
  location          String?
  followersCount    Int?
  followingCount    Int?
  postsCount        Int?
  verified          Boolean    @default(false)
  score             Int        @default(0)
  status            LeadStatus @default(new)  // Legacy, kept for compatibility
  position          Float      @default(0)    // For manual ordering in Kanban
  notes             String?
  sourceUrl         String?
  customFields      Json       @default("{}")
  lastInteractionAt DateTime?
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  // LinkedIn-specific fields
  headline          String?    // Professional title/position
  company           String?    // Current company/employer
  industry          String?    // Industry/sector
  connectionCount   Int?       // Number of connections
  // Enrichment metadata
  enrichedAt        DateTime?
  enrichmentStatus  EnrichmentStatus @default(none)
  // New fields for expanded lead data
  gender            LeadGender?
  priority          LeadPriority?
  jobTitle          String?    // Specific job title (from experience or headline parsing)
  companySize       CompanySize?

  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  assignedToId String?
  assignedTo   User?   @relation("AssignedLeads", fields: [assignedToId], references: [id], onDelete: SetNull)

  pipelineStageId String?
  pipelineStage   PipelineStage? @relation(fields: [pipelineStageId], references: [id], onDelete: SetNull)

  tags           LeadTag[]
  socialProfiles SocialProfile[]
  conversation   Conversation?
  activities     Activity[]
  automationLogs AutomationLog[]
  behavior       LeadBehavior?
  address        LeadAddress?
  // LinkedIn enrichment relations
  experiences      LeadExperience[]
  educations       LeadEducation[]
  certifications   LeadCertification[]
  skills           LeadSkill[]
  languages        LeadLanguage[]
  recommendations  LeadRecommendation[]
  volunteers       LeadVolunteer[]
  publications     LeadPublication[]
  patents          LeadPatent[]
  projects         LeadProject[]
  courses          LeadCourse[]
  honors           LeadHonor[]
  organizations    LeadOrganization[]
  featured         LeadFeatured[]
  contactInfo      LeadContactInfo?
  leadPosts        LeadPost[]
  posts            Post[]           @relation("PostsLibrary")

  @@unique([workspaceId, platform, profileUrl]) // Keep for backward compatibility or primary profile
  @@index([workspaceId, status])
  @@index([workspaceId, platform])
  @@index([workspaceId, score])
  @@index([workspaceId, createdAt])
  @@index([assignedToId])
  @@index([pipelineStageId, position])
  @@index([enrichmentStatus])
  @@map("leads")
}

model SocialProfile {
  id              String   @id @default(cuid())
  platform        Platform
  username        String?
  profileUrl      String
  avatarUrl       String?
  bio             String?
  followersCount  Int?
  followingCount  Int?
  postsCount      Int?
  verified        Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  leadId          String
  lead            Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)

  workspaceId     String
  workspace       Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, platform, profileUrl])
  @@index([leadId])
  @@map("social_profiles")
}

enum Platform {
  instagram
  facebook
  linkedin
  twitter
  tiktok
  whatsapp
  telegram
  discord
  reddit
  skool
  slack
  pinterest
  youtube
  nextdoor
  gohighlevel
  other
}

enum LeadStatus {
  new
  contacted
  responded
  qualified
  scheduled
  closed
  lost
}

// ============================================
// TAGS
// ============================================

model Tag {
  id        String   @id @default(cuid())
  name      String
  color     String   @default("#6366F1")
  createdAt DateTime @default(now())

  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  leads LeadTag[]
  posts PostTag[]

  @@unique([workspaceId, name])
  @@map("tags")
}

model LeadTag {
  leadId String
  lead   Lead   @relation(fields: [leadId], references: [id], onDelete: Cascade)

  tagId String
  tag   Tag    @relation(fields: [tagId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@id([leadId, tagId])
  @@map("lead_tags")
}

// ============================================
// CONVERSATIONS & MESSAGES
// ============================================

model Conversation {
  id            String             @id @default(cuid())
  platform      Platform
  status        ConversationStatus @default(active)
  unreadCount   Int                @default(0)
  lastMessageAt DateTime?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt

  leadId String @unique
  lead   Lead   @relation(fields: [leadId], references: [id], onDelete: Cascade)

  assignedToId String?
  assignedTo   User?   @relation("AssignedConversations", fields: [assignedToId], references: [id], onDelete: SetNull)

  messages Message[]

  @@index([leadId])
  @@index([assignedToId])
  @@index([status, lastMessageAt])
  @@map("conversations")
}

enum ConversationStatus {
  active
  archived
}

model Message {
  id          String        @id @default(cuid())
  content     String
  senderType  SenderType
  messageType MessageType   @default(text)
  status      MessageStatus @default(pending)
  metadata    Json          @default("{}")
  readAt      DateTime?
  sentAt      DateTime      @default(now())

  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  senderId String?
  sender   User?   @relation("SentMessages", fields: [senderId], references: [id], onDelete: SetNull)

  @@index([conversationId, sentAt])
  @@map("messages")
}

enum SenderType {
  agent
  lead
  system
}

enum MessageType {
  text
  image
  video
  audio
  document
  template
}

enum MessageStatus {
  pending
  sent
  delivered
  read
  failed
}

// ============================================
// TEMPLATES
// ============================================

model Template {
  id        String    @id @default(cuid())
  name      String
  content   String
  platform  Platform?
  category  String?
  variables Json      @default("[]")
  stats     Json      @default("{\"sent\": 0, \"responseRate\": 0}")
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  createdById String
  createdBy   User   @relation("CreatedTemplates", fields: [createdById], references: [id], onDelete: Cascade)

  @@index([workspaceId])
  @@map("templates")
}

// ============================================
// AUTOMATIONS
// ============================================

model Automation {
  id            String  @id @default(cuid())
  name          String
  description   String?
  triggerType   String
  triggerConfig Json
  actions       Json
  conditions    Json    @default("[]")
  enabled       Boolean @default(true)
  stats         Json    @default("{\"runs\": 0, \"success\": 0, \"failed\": 0}")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  pipelineStageId String?
  pipelineStage   PipelineStage? @relation(fields: [pipelineStageId], references: [id], onDelete: SetNull)

  createdById String
  createdBy   User   @relation("CreatedAutomations", fields: [createdById], references: [id], onDelete: Cascade)

  logs AutomationLog[]

  @@index([workspaceId, enabled])
  @@index([pipelineStageId])
  @@map("automations")
}

model AutomationLog {
  id              String              @id @default(cuid())
  status          AutomationLogStatus
  triggerType     String              @default("MANUAL") // MANUAL, EVENT
  result          Json                @default("{}") // Stores leads processed, actions taken, errors
  actionsExecuted Int                 @default(0)
  errorMessage    String?
  metadata        Json                @default("{}")
  startedAt       DateTime            @default(now())
  completedAt     DateTime?
  executedAt      DateTime            @default(now()) // Keep for backward compat or remove? Let's keep.

  automationId String
  automation   Automation @relation(fields: [automationId], references: [id], onDelete: Cascade)

  leadId String?
  lead   Lead?   @relation(fields: [leadId], references: [id], onDelete: SetNull)

  @@index([automationId, startedAt])
  @@map("automation_logs")
}

enum AutomationLogStatus {
  success
  failed
  skipped
  pending
  running
}

// ============================================
// ACTIVITIES (Audit Trail)
// ============================================

model Activity {
  id          String       @id @default(cuid())
  type        ActivityType
  description String?
  metadata    Json         @default("{}")
  createdAt   DateTime     @default(now())

  leadId String?
  lead   Lead?   @relation(fields: [leadId], references: [id], onDelete: Cascade)

  userId String?
  user   User?   @relation("UserActivities", fields: [userId], references: [id], onDelete: SetNull)

  @@index([leadId, createdAt])
  @@index([userId, createdAt])
  @@map("activities")
}

enum ActivityType {
  lead_created
  lead_updated
  lead_imported
  status_changed
  tag_added
  tag_removed
  assigned
  message_sent
  message_received
  score_updated
  automation_triggered
  note_added
}

// ============================================
// WEBHOOKS
// ============================================

model Webhook {
  id              String    @id @default(cuid())
  url             String
  events          String[]
  secret          String?
  enabled         Boolean   @default(true)
  lastTriggeredAt DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId])
  @@map("webhooks")
}

// ============================================
// IMPORT JOBS
// ============================================

model ImportJob {
  id          String          @id @default(cuid())
  platform    Platform
  sourceUrl   String?
  status      ImportJobStatus @default(queued)
  progress    Int             @default(0)
  totalLeads  Int             @default(0)
  result      Json?
  error       String?
  createdAt   DateTime        @default(now())
  completedAt DateTime?

  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId, createdAt])
  @@map("import_jobs")
}

enum ImportJobStatus {
  queued
  processing
  completed
  failed
}

// ============================================
// LEAD BEHAVIOR (Deep Profiling)
// ============================================

model LeadBehavior {
  id              String   @id @default(cuid())
  leadId          String   @unique
  lead            Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)

  maritalStatus   String?  // "married", "single", "unknown"
  hasChildren     Boolean?
  deviceType      String?  // "iphone", "android", etc
  interests       String[]
  personalityType String?  // e.g. "Dominant", "Analytical"
  buyingIntent    String?  // "High", "Medium", "Low"

  confidenceScore Float    // 0-100
  rawAnalysis     Json     // Full AI analysis details

  analyzedAt      DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("lead_behaviors")
}

// ============================================
// LEAD ADDRESS (Expanded address details)
// ============================================

model LeadAddress {
  id        String   @id @default(cuid())
  street    String?
  city      String?
  state     String?
  zipCode   String?
  country   String?  // ISO 2-letter code (e.g., "BR", "US")

  lead      Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  leadId    String   @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([leadId])
  @@map("lead_addresses")
}

// ============================================
// AUDIENCE (Segmentation Criteria)
// ============================================

model Audience {
  id          String   @id @default(cuid())
  name        String
  
  // Detalhes do Perfil
  gender                String[] @default([])     // ["male", "female"]
  ignoreGenderIfUnknown Boolean  @default(true)   // Ignora critério se gênero não determinável
  countries             String[] @default([])     // códigos ISO
  ignoreCountryIfUnknown Boolean @default(true)   // Ignora critério se país não determinável
  excludePrivate        Boolean  @default(false)
  excludeNoMessage      Boolean  @default(false)
  excludeNoPhoto        Boolean  @default(false)
  excludeCompanyPages   Boolean  @default(false)
  verifiedFilter        String   @default("any")  // "any", "verified_only", "unverified_only"
  
  // Atividade Social (opcional min/max)
  friendsMin       Int?
  friendsMax       Int?
  mutualFriendsMin Int?
  mutualFriendsMax Int?
  followersMin     Int?
  followersMax     Int?
  postsMin         Int?
  postsMax         Int?
  
  // Keywords (arrays separados incluir/excluir)
  jobTitleInclude       String[] @default([])
  jobTitleExclude       String[] @default([])
  profileInfoInclude    String[] @default([])
  profileInfoExclude    String[] @default([])
  postContentInclude    String[] @default([])
  postContentExclude    String[] @default([])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  
  @@unique([workspaceId, name])
  @@index([workspaceId])
  @@map("audiences")
}

// ============================================
// LEAD SCORING
// ============================================

model ScoringConfig {
  id          String   @id @default(cuid())

  // Scoring weights (0-100, should sum to 100)
  jobTitleWeight            Int @default(25)  // Weight for job title match
  companyWeight             Int @default(20)  // Weight for company relevance
  profileCompletenessWeight Int @default(15)  // Weight for profile completeness
  activityWeight            Int @default(20)  // Weight for activity signals
  enrichmentWeight          Int @default(20)  // Weight for enrichment data quality

  // Target criteria (ICP - Ideal Customer Profile)
  targetJobTitles       String[]      @default([])  // e.g., ["CEO", "CTO", "VP of Engineering"]
  targetCompanySizes    CompanySize[] @default([])  // e.g., [SIZE_51_200, SIZE_201_500]
  targetIndustries      String[]      @default([])  // e.g., ["Technology", "Software"]
  minProfileCompleteness Int          @default(50)  // Minimum profile completeness score (0-100)

  // Additional settings
  autoScoreOnImport Boolean @default(true)  // Automatically score new leads
  autoScoreOnUpdate Boolean @default(true)  // Automatically rescore when lead data changes

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workspaceId String    @unique  // One config per workspace
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId])
  @@map("scoring_configs")
}

// ============================================
// LINKEDIN ENRICHMENT
// ============================================

enum EnrichmentStatus {
  none
  partial
  complete
  failed
}

enum LeadGender {
  male
  female
  other
  unknown
}

enum LeadPriority {
  low
  medium
  high
  urgent
}

enum CompanySize {
  SIZE_1_10
  SIZE_11_50
  SIZE_51_200
  SIZE_201_500
  SIZE_501_1000
  SIZE_1001_5000
  SIZE_5001_10000
  SIZE_10001_PLUS
}

model LeadExperience {
  id             String   @id @default(cuid())
  leadId         String
  lead           Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  companyName    String
  companyUrl     String?
  companyLogo    String?
  roleTitle      String
  employmentType String?  // Full-time, Part-time, Contract, etc.
  location       String?
  startDate      String?
  endDate        String?  // null = current
  duration       String?
  description    String?
  skills         String[] @default([])
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([leadId, companyName, roleTitle, startDate])
  @@index([leadId])
  @@map("lead_experiences")
}

model LeadEducation {
  id           String   @id @default(cuid())
  leadId       String
  lead         Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  school       String
  schoolUrl    String?
  schoolLogo   String?
  degree       String?
  fieldOfStudy String?
  startDate    String?
  endDate      String?
  grade        String?
  activities   String?
  description  String?
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([leadId, school, degree, startDate])
  @@index([leadId])
  @@map("lead_educations")
}

model LeadCertification {
  id             String   @id @default(cuid())
  leadId         String
  lead           Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  name           String
  issuer         String?
  issuerUrl      String?
  issuerLogo     String?
  issueDate      String?
  expirationDate String?
  credentialId   String?
  credentialUrl  String?
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([leadId, name, issuer])
  @@index([leadId])
  @@map("lead_certifications")
}

model LeadSkill {
  id               String   @id @default(cuid())
  leadId           String
  lead             Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  name             String
  endorsementsCount Int?
  category         String?
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@unique([leadId, name])
  @@index([leadId])
  @@map("lead_skills")
}

model LeadLanguage {
  id          String   @id @default(cuid())
  leadId      String
  lead        Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  name        String
  proficiency String?  // Native, Full Professional, Professional Working, Limited Working, Elementary
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([leadId, name])
  @@index([leadId])
  @@map("lead_languages")
}

model LeadRecommendation {
  id             String   @id @default(cuid())
  leadId         String
  lead           Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  authorName     String
  authorUrl      String?
  authorHeadline String?
  authorAvatar   String?
  relationship   String?
  date           String?
  text           String?
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([leadId, authorName, date])
  @@index([leadId])
  @@map("lead_recommendations")
}

model LeadVolunteer {
  id           String   @id @default(cuid())
  leadId       String
  lead         Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  organization String
  role         String?
  cause        String?
  startDate    String?
  endDate      String?
  description  String?
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([leadId, organization, role])
  @@index([leadId])
  @@map("lead_volunteers")
}

model LeadPublication {
  id          String   @id @default(cuid())
  leadId      String
  lead        Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  title       String
  publisher   String?
  date        String?
  url         String?
  description String?
  authors     String[] @default([])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([leadId, title, publisher])
  @@index([leadId])
  @@map("lead_publications")
}

model LeadPatent {
  id            String   @id @default(cuid())
  leadId        String
  lead          Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  title         String
  patentNumber  String?
  status        String?  // Pending, Granted
  date          String?
  url           String?
  description   String?
  inventors     String[] @default([])
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([leadId, title, patentNumber])
  @@index([leadId])
  @@map("lead_patents")
}

model LeadProject {
  id            String   @id @default(cuid())
  leadId        String
  lead          Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  title         String
  url           String?
  startDate     String?
  endDate       String?
  description   String?
  collaborators String[] @default([])
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([leadId, title])
  @@index([leadId])
  @@map("lead_projects")
}

model LeadCourse {
  id             String   @id @default(cuid())
  leadId         String
  lead           Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  name           String
  courseNumber   String?
  associatedWith String?  // School or company name
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([leadId, name])
  @@index([leadId])
  @@map("lead_courses")
}

model LeadHonor {
  id          String   @id @default(cuid())
  leadId      String
  lead        Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  title       String
  issuer      String?
  date        String?
  description String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([leadId, title, issuer])
  @@index([leadId])
  @@map("lead_honors")
}

model LeadOrganization {
  id          String   @id @default(cuid())
  leadId      String
  lead        Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  name        String
  position    String?
  startDate   String?
  endDate     String?
  description String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([leadId, name, position])
  @@index([leadId])
  @@map("lead_organizations")
}

model LeadFeatured {
  id           String   @id @default(cuid())
  leadId       String
  lead         Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  type         String   // post, article, link, media
  title        String?
  url          String?
  thumbnailUrl String?
  description  String?
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([leadId])
  @@map("lead_featured")
}

model LeadContactInfo {
  id         String   @id @default(cuid())
  leadId     String   @unique
  lead       Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  email      String?
  phone      String?
  website    String?
  twitter    String?
  birthday   String?
  address    String?
  profileUrl String?
  
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("lead_contact_info")
}

model LeadPost {
  id         String   @id @default(cuid())
  leadId     String
  lead       Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)

  content    String?
  date       String?
  likes      Int?
  comments   Int?
  shares     Int?
  imageUrls  String[] @default([])
  videoUrls  String[] @default([])
  linkedUrl  String?  // External link in the post
  postUrl    String?  // URL to the post itself
  postType   String?  // post, share, article, comment

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([leadId])
  @@map("lead_posts")
}

// ============================================
// POSTS (Standalone Posts Library)
// ============================================

model Post {
  id              String    @id @default(cuid())
  platform        Platform
  postUrl         String
  content         String?
  imageUrls       String[]  @default([])
  videoUrls       String[]  @default([])
  linkedUrl       String?
  postType        String?   // post, reel, story, article, share

  // Engagement metrics
  likesCount      Int?
  commentsCount   Int?
  sharesCount     Int?
  viewsCount      Int?

  // Author info
  authorUsername  String
  authorFullName  String?
  authorAvatarUrl String?
  authorProfileUrl String?

  // Optional link to existing Lead
  leadId          String?
  lead            Lead?     @relation("PostsLibrary", fields: [leadId], references: [id], onDelete: SetNull)

  // Metadata
  postDate        DateTime?
  importedAt      DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Multi-tenancy
  workspaceId     String
  workspace       Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  tags            PostTag[]

  @@unique([workspaceId, platform, postUrl])
  @@index([workspaceId, platform])
  @@index([workspaceId, authorUsername])
  @@index([workspaceId, importedAt])
  @@index([leadId])
  @@map("posts")
}

model PostTag {
  postId    String
  post      Post   @relation(fields: [postId], references: [id], onDelete: Cascade)
  tagId     String
  tag       Tag    @relation(fields: [tagId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@id([postId, tagId])
  @@map("post_tags")
}
