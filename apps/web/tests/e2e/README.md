# E2E Tests

This directory contains end-to-end tests for the Lia 360 web application using Playwright.

## Prerequisites

Before running E2E tests, ensure:

1. **Web server is running**: `npm run web:dev` (default: http://localhost:3000)
2. **API server is running**: `npm run api:dev` (default: http://localhost:3001)

## Running Tests

### Run all E2E tests (requires API server)
```bash
cd apps/web
npx playwright test
```

### Run specific test file
```bash
cd apps/web
npx playwright test auth.spec.ts
```

### Run in headed mode (see browser)
```bash
cd apps/web
npx playwright test auth.spec.ts --headed
```

### Run with UI mode
```bash
cd apps/web
npx playwright test auth.spec.ts --ui
```

## Test Categories

### UI Validation Tests (No API Required)
These tests validate the UI without requiring the API server:
- Form labels and placeholders
- Password requirements hint
- Navigation between pages
- HTML5 validation

### API Integration Tests (Requires API Server)
These tests require the API server to be running:
- User registration
- Login flow
- Error handling
- Network error handling

## Current Test Status

### auth.spec.ts - User Registration Flow
- ✅ 6/12 tests passing (UI validation tests)
- ⚠️  6/12 tests require API server

#### Passing Tests:
1. ✅ should show validation errors for missing required fields
2. ✅ should show validation error for invalid email format
3. ✅ should show validation error for short password
4. ✅ should navigate to login page when clicking "Entrar" link
5. ✅ should have proper form labels and placeholders
6. ✅ should display password requirements hint

#### Tests requiring API server:
1. ⚠️  should register a new user with all fields
2. ⚠️  should display loading state during registration
3. ⚠️  should show success toast after successful registration
4. ⚠️  should handle registration with existing email error
5. ⚠️  should auto-login user after successful registration
6. ⚠️  should handle network errors gracefully

## Debugging Failed Tests

When tests fail, Playwright automatically captures:
- Screenshots: `test-results/screenshots/`
- Videos: `test-results/videos/`
- Traces: `test-results/traces/`

View traces with:
```bash
npx playwright show-trace test-results/traces/<trace-file>.zip
```

## Notes

- Tests use realistic test data generated by `createTestUserData()` helper
- Each test clears cookies and storage to ensure isolation
- Tests use Playwright's built-in assertions with `expect()` for better error messages
- Sonner toast notifications are detected using `[data-sonner-toast]` selector
